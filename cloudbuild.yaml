# This is a sample build configuration for JavaScript.
# Check our guides at https://cloud.google.com/cloud-build/docs/deploying-builds/
# Only use spaces to indent your .yaml configuration.
# -----
# You can specify a custom docker steps or other builder steps, look in docs
steps:

  # Pull Repo Code
  - name: 'gcr.io/cloud-builders/git'
    id: 'cloning-git-repo'
    args: ['clone', 'https://github.com/Danail-Irinkov/vue-storefront-api']

  # Build the vsf containers
  - name: 'gcr.io/cloud-builders/docker'
    id: 'docker-build-vsf-api'
    args: ['build', '-t', 'gcr.io/$PROJECT_ID/vue-storefront-api', '-f', 'docker/vue-storefront-api/Dockerfile', '.']

  # Push the vsf containers to gcr.io repo
  - name: 'gcr.io/cloud-builders/docker'
    id: 'docker-push-vsf-api'
    args: ['push', 'gcr.io/$PROJECT_ID/vue-storefront-api']

  # Deploy to GKE
  - name: 'gcr.io/cloud-builders/gke-deploy'
    args:
      - 'apply'
      - '-f'
      - 'kube'
      - '--location=europe-west3-c'
      - '--cluster=procc-kub2'
    timeout: '60s'

images: ['gcr.io/$PROJECT_ID/vue-storefront-api']

options:
  machineType: 'N1_HIGHCPU_8'
